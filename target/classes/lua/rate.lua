--- 限流lua脚本
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by sunyw.
--- DateTime: 2020/12/27 16:05
---
-- methodKey = methodKey:ip
local methodKey = KEYS[1]
redis.log(redis.LOG_DEBUG, 'key is', methodKey)
-- limit count 配置的limit
local limit = tonumber(ARGV[1])
-- limit sum 累积
local count = tonumber(redis.call('get', methodKey) or "0")
-- 是否超出
if count + 1 > limit then
    return false
else
    --加1,设置过期时间
    redis.call("incr", methodKey)
    redis.call("expire", methodKey, ARGV[2])
    return true
end